<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Be My Valentine ðŸ’–</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffb6c1, #ffc0cb, #ffd6e8);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
      touch-action: manipulation;
    }

    .card {
      width: min(92vw, 420px);
      background: rgba(255, 255, 255, 0.95);
      padding: 30px 20px;
      border-radius: 30px;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      position: relative;
      z-index: 10;
    }

    h1 { color: #e60073; font-size: 1.7rem; margin: 0 0 10px; }
    p { color: #555; margin: 0 0 20px; }

    /* Button Area */
    .btn-row { position: relative; height: 160px; margin-top: 10px; }
    .btn {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 30px;
      font-size: 1.1rem;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      white-space: nowrap;
    }
    #yesBtn { background: #ff4da6; color: white; z-index: 20; }
    #noBtn { background: #eee; color: #555; top: 90px; z-index: 15; transition: all 0.2s ease; }

    /* Photo Stack */
    .result { display: none; }
    .photo-stack {
      position: relative;
      width: 260px;
      height: 350px; /* Taller for video */
      margin: 20px auto;
    }
    
    .stacked-photo, video.stacked-photo {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      object-fit: cover;
      border: 6px solid white;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.6s;
    }
    
    .photo-exit { transform: translateY(-120vh) rotate(30deg) !important; opacity: 0; }

    .final-text {
      display: none;
      font-size: 1.8rem;
      font-weight: bold;
      color: #e60073;
      margin-top: 20px;
      animation: heartBeat 1.2s infinite;
    }

    .tap-hint { font-size: 0.85rem; color: #888; margin-top: 10px; font-style: italic; }

    /* Lilies */
    .lily { position: absolute; font-size: 2rem; animation: float 10s linear infinite; opacity: 0.7; pointer-events: none; }
    @keyframes float {
      0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
      10% { opacity: 0.7; }
      100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; }
    }
    @keyframes heartBeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

    .music-hint { position: fixed; bottom: 10px; font-size: 0.7rem; color: #888; }
  </style>
</head>
<body>

  <audio id="bgm" loop><source src="yung-kai-blue.mp3" type="audio/mpeg"></audio>

  <div class="card">
    <div id="askInterface">
      <h1>Will you be my Valentine? ðŸŒ¸</h1>
      <p>I put a lot of effort into this... pls say yes ðŸ¥º</p>
      <div class="btn-row" id="playArea">
        <button class="btn" id="yesBtn">Yes ðŸ’–</button>
        <button class="btn" id="noBtn">No ðŸ™„</button>
      </div>
    </div>

    <div class="result" id="resultInterface">
      <div class="photo-stack">
        <video id="finalVid" class="stacked-photo" playsinline>
          <source src="final_video.mp4" type="video/mp4">
        </video>
	
        <img src="10.jpeg" class="stacked-photo">
        <img src="8.jpeg" class="stacked-photo">
        <img src="7.jpeg" class="stacked-photo">
        <img src="6.jpeg" class="stacked-photo">
        <img src="5.jpeg" class="stacked-photo">
        <img src="4.jpeg" class="stacked-photo">
        <img src="3.jpeg" class="stacked-photo">
        <img src="2.jpeg" class="stacked-photo">
        <img src="1.jpeg" class="stacked-photo">
      </div>
      <div id="tapHint" class="tap-hint">Tap photos to uncover them! ðŸ‘‡</div>
      <div id="finalMessage" class="final-text">I LOVE YOU MOREEEE ðŸ’–</div>
    </div>
  </div>

  <div class="music-hint">Tap anywhere to start music ðŸŽµ</div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const playArea = document.getElementById('playArea');
    const bgm = document.getElementById('bgm');
    const finalVid = document.getElementById('finalVid');
    const askInterface = document.getElementById('askInterface');
    const resultInterface = document.getElementById('resultInterface');

    let yesSize = 1;
    let phraseIndex = 0;
    const phrases = ["No ðŸ™„", "You sure? ðŸ§", "Really? ðŸ¥º", "Last chance! ðŸ˜…", "Nice try! ðŸƒâ€â™‚ï¸", "Just click Yes! â¤ï¸"];

    // Media Unlocker
    const startMedia = () => {
      bgm.play().catch(e => console.log("Audio play failed:", e));
      finalVid.load(); 
      document.querySelector('.music-hint').style.display = 'none';
    };

    function moveNo() {
      startMedia();
      const area = playArea.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();
      const x = Math.random() * (area.width - btn.width);
      const y = Math.random() * (area.height - btn.height);
      noBtn.style.left = x + 'px';
      noBtn.style.top = y + 'px';
      noBtn.style.transform = 'none';
      
      phraseIndex = (phraseIndex + 1) % phrases.length;
      noBtn.innerText = phrases[phraseIndex];
      
      yesSize += 0.2;
      yesBtn.style.transform = `translateX(-50%) scale(${yesSize})`;
    }

    noBtn.addEventListener('mouseenter', moveNo);
    noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveNo(); });

    yesBtn.addEventListener('click', () => {
      startMedia();
      askInterface.style.display = 'none';
      resultInterface.style.display = 'block';
      
      confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

      const items = document.querySelectorAll('.stacked-photo');
      let itemsRemoved = 0;

      items.forEach(item => {
        // Only images are clickable initially
        if(item.tagName === 'IMG') {
          item.addEventListener('click', () => {
            item.classList.add('photo-exit');
            itemsRemoved++;
            
            confetti({ particleCount: 20, spread: 30, origin: { y: 0.8 }, colors: ['#ff4da6'] });

            // If 8 photos are removed, the video is revealed
            if (itemsRemoved === 8) {
              finalVid.play().catch(e => console.log("Video error:", e));
              document.getElementById('tapHint').innerText = "Tap video to finish... â¤ï¸";
              
              // Make video clickable to show final message
              finalVid.addEventListener('click', () => {
                 finalVid.classList.add('photo-exit');
                 document.getElementById('finalMessage').style.display = 'block';
                 document.getElementById('tapHint').style.display = 'none';
                 confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
              }, { once: true });
            }
          });
        }
      });
    });

    document.body.addEventListener('click', startMedia, { once: true });
  </script>
</body>
</html>